import{f as R,aw as v,h,D as q,I as U,ax as m,b4 as A}from"./R_UQo4UH.js";function B(a){return a.pricing?.final_price?a.pricing.final_price:a.variation?.price||a.product?.price||0}function Q(a){return a.pricing?.total_final?a.pricing.total_final:B(a)*a.quantity}const Y=globalThis.setInterval,f=(a,g,o)=>{const c=g.data,p=c?.message||o,i=c?.available_stock;a.add({title:"Error",description:i!==void 0?`${p}. Only ${i} available.`:p,color:"error"})},z=()=>{const a=R(),g=A(),o=v("cart",()=>[]),c=v("cartTotals",()=>null),p=v("appliedDiscounts",()=>[]),i=v("isCartOpen",()=>!1),s=v("cartLoading",()=>!1),l=v("reservationTimer",()=>null),y=h(()=>c.value?.final?c.value.final:o.value.reduce((e,t)=>e+Q(t),0)),C=h(()=>c.value?.original?c.value.original:y.value),I=h(()=>c.value?.discount||0),_=h(()=>c.value?.savings||0),w=h(()=>o.value.reduce((e,t)=>e+t.quantity,0)),b=async e=>{const t=g.public.apiBase.replace(/\/$/,"");try{return(await $fetch(`${t}/products/${e}`)).data}catch(r){return console.error(`Failed to fetch product ${e}:`,r),null}},u=async()=>{try{s.value=!0;const e=await $fetch("/api/cart");return e.items?.length?o.value=await Promise.all(e.items.map(async t=>{if(!t.product&&t.slug){const r=await b(t.slug);return r?{...t,product:r}:t}return t})):o.value=e.items||[],c.value=e?.totals||null,p.value=e?.applied_discounts||[],e}catch(e){return console.error("Failed to fetch cart:",e),f(a,e,"Failed to load cart"),null}finally{s.value=!1}},F=async(e,t=1,r)=>{try{s.value=!0;const n={slug:e,quantity:t};r&&(n.variation_id=r);const d=await $fetch("/api/cart/add",{method:"POST",body:n});return await u(),a.add({title:"Success",description:d.message||"Added to cart",color:"success"}),!0}catch(n){return f(a,n,"Failed to add item to cart"),!1}finally{s.value=!1}},D=async(e,t,r)=>{try{s.value=!0;const n={quantity:t};r!==void 0&&(n.variation_id=r);const d=await $fetch(`/api/cart/update/${e}`,{method:"PUT",body:n});return await u(),a.add({title:"Success",description:d.message||"Cart updated",color:"success"}),!0}catch(n){return f(a,n,"Failed to update cart"),await u(),!1}finally{s.value=!1}},S=async(e,t)=>{try{s.value=!0;let r=`/api/cart/remove/${e}`;t!==void 0&&(r+=`?variation_id=${t}`);const n=await $fetch(r,{method:"DELETE"});return await u(),a.add({title:"Removed",description:n.message||"Item removed from cart",color:"warning"}),!0}catch(r){return f(a,r,"Failed to remove item"),!1}finally{s.value=!1}},E=async()=>{try{s.value=!0;const e=await $fetch("/api/cart/clear",{method:"DELETE"});return o.value=[],a.add({title:"Cart Cleared",description:e.message||"All items removed from cart",color:"warning"}),!0}catch(e){return f(a,e,"Failed to clear cart"),!1}finally{s.value=!1}},O=async()=>{try{s.value=!0;const e=await $fetch("/api/cart/checkout",{method:"POST"});return o.value=[],i.value=!1,l.value&&(clearInterval(l.value),l.value=null),a.add({title:"Order Placed!",description:e.message||"Your order has been placed successfully",color:"success"}),!0}catch(e){return f(a,e,"Failed to complete checkout"),await u(),!1}finally{s.value=!1}},T=async()=>{if(w.value!==0)try{await $fetch("/api/cart/extend-reservation",{method:"POST"})}catch(e){console.error("Failed to extend reservation:",e)}},P=()=>{l.value&&clearInterval(l.value),l.value=Y(()=>{T()},600*1e3)},k=()=>{l.value&&(clearInterval(l.value),l.value=null)},x=()=>{i.value=!i.value},$=(e,t)=>o.value.find(r=>{const n=r.slug===e,d=(r.variation_id??null)===(t??null);return n&&d}),L=(e,t)=>o.value.some(r=>{const n=r.slug===e,d=(r.variation_id??null)===(t??null);return n&&d}),M=(e,t)=>$(e,t)?.quantity||0;return q(async()=>{await u(),P()}),U(()=>{k()}),{cartItems:m(o),cartTotal:y,cartOriginalTotal:C,cartDiscount:I,cartSavings:_,cartTotals:m(c),appliedDiscounts:m(p),cartItemsCount:w,isCartOpen:i,isLoading:m(s),addToCart:F,updateCartItemQuantity:D,removeFromCart:S,clearCart:E,checkout:O,toggleCart:x,fetchCart:u,extendReservation:T,getItemBySlug:$,isInCart:L,getItemQuantity:M}};export{z as u};
